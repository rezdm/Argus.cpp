<!DOCTYPE html>
<html>
<head>
    <title>Argus Monitor</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;700&display=swap');

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'IBM Plex Mono', 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            background-color: #000000;
            color: #c0c0c0;
            font-size: 14px;
            line-height: 1.2;
            overflow-x: auto;
        }

        .terminal-screen {
            max-width: none;
            margin: 0 auto;
            background-color: #000000;
            padding: 10px;
            border: 2px solid #404040;
            font-family: 'IBM Plex Mono', monospace;
        }

        pre {
            margin: 0;
            padding: 0;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 14px;
            line-height: 1.2;
            white-space: pre;
        }

        .header-text { color: #ffffff; font-weight: bold; }
        .label { color: #808080; }
        .group-title { color: #00ffff; font-weight: bold; }

        .status-pending { color: #808080; }
        .status-ok { color: #00ff00; }
        .status-warning { color: #ffff00; }
        .status-error { color: #ff0000; }

        .loading, .error {
            text-align: center;
            padding: 20px;
            color: #808080;
        }

        .error { color: #ff0000; }

        .cursor {
            animation: blink 1s step-start infinite;
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        @media (max-width: 768px) {
            body { font-size: 10px; padding: 5px; }
            pre { font-size: 10px; }
        }
    </style>
</head>
<body>
    <div class="terminal-screen">
        <div id="content">
<pre class="loading">Loading...</pre>
        </div>
    </div>

    <script>
        function getStatusSymbol(status) {
            switch (status.toLowerCase()) {
                case 'pending': return '?';
                case 'ok': return '✓';
                case 'warning': return '!';
                case 'failure': return '✗';
                default: return '?';
            }
        }

        function getStatusClass(status) {
            switch (status.toLowerCase()) {
                case 'pending': return 'status-pending';
                case 'ok': return 'status-ok';
                case 'warning': return 'status-warning';
                case 'failure': return 'status-error';
                default: return 'status-pending';
            }
        }

        function pad(str, len) {
            str = String(str).substring(0, len);
            return str + ' '.repeat(Math.max(0, len - str.length));
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function updateMonitorData() {
            fetch('/argus/status')
                .then(response => response.ok ? response.json() : Promise.reject('Network error'))
                .then(data => {
                    let output = '';

                    // Header
                    output += '╔══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╗\n';
                    output += '║ <span class="header-text">' + pad(data.name.toUpperCase(), 124) + '</span> ║\n';
                    output += '║ <span class="label">' + pad('Last Update: ' + data.timestamp, 124) + '</span> ║\n';
                    output += '╚══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╝\n';
                    output += '\n';

                    let totalMonitors = 0, okCount = 0, warningCount = 0, errorCount = 0, pendingCount = 0;

                    // Process each group
                    data.groups.forEach(group => {
                        output += '┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐\n';
                        output += '│ <span class="group-title">' + pad(group.name.toUpperCase(), 122) + '</span> │\n';
                        output += '├──────────────┬────────────────────┬────────┬───────────┬──────────┬─────────────┬────────────────────────────────────────┤\n';
                        output += '│ <span class="header-text">SERVICE</span>      │ <span class="header-text">HOST</span>               │ <span class="header-text">STATUS</span> │ <span class="header-text">TIME</span>      │ <span class="header-text">UPTIME</span>   │ <span class="header-text">LAST CHECK</span>  │ <span class="header-text">DETAILS</span>                                │\n';
                        output += '├──────────────┼────────────────────┼────────┼───────────┼──────────┼─────────────┼────────────────────────────────────────┤\n';

                        group.monitors.forEach(monitor => {
                            totalMonitors++;
                            const statusLower = monitor.status.toLowerCase();
                            if (statusLower === 'ok') okCount++;
                            else if (statusLower === 'warning') warningCount++;
                            else if (statusLower === 'failure') errorCount++;
                            else pendingCount++;

                            const service = pad(monitor.service, 12);
                            const host = pad(monitor.host, 18);
                            const statusSymbol = getStatusSymbol(monitor.status);
                            const statusText = pad(monitor.status.toUpperCase(), 4);
                            const statusClass = getStatusClass(monitor.status);
                            const time = pad(monitor.response_time, 9);

                            const uptimePercent = Math.round(monitor.uptime_percent);
                            const barLength = 6;
                            const filled = Math.round((uptimePercent / 100) * barLength);
                            const uptimeBar = '█'.repeat(filled) + '░'.repeat(barLength - filled);
                            const uptimeText = pad(uptimeBar + ' ' + uptimePercent + '%', 8);

                            const lastCheck = pad(monitor.last_check.split(' ')[1] || 'Never', 11);
                            const details = pad(monitor.details, 38);

                            output += '│ ' + escapeHtml(service) + ' │ ' + escapeHtml(host) + ' │ ';
                            output += '<span class="' + statusClass + '">' + statusSymbol + ' ' + escapeHtml(statusText) + '</span> │ ';
                            output += escapeHtml(time) + ' │ ' + escapeHtml(uptimeText) + ' │ ' + escapeHtml(lastCheck) + ' │ ' + escapeHtml(details) + ' │\n';
                        });

                        output += '└──────────────┴────────────────────┴────────┴───────────┴──────────┴─────────────┴────────────────────────────────────────┘\n';
                        output += '\n';
                    });

                    // Summary
                    output += '┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐\n';
                    output += '│ <span class="header-text">SUMMARY:</span> Total: ' + pad(totalMonitors, 4) + ' │ ';
                    output += '<span class="status-ok">OK: ' + pad(okCount, 4) + '</span> │ ';
                    output += '<span class="status-warning">WARN: ' + pad(warningCount, 4) + '</span> │ ';
                    output += '<span class="status-error">FAIL: ' + pad(errorCount, 4) + '</span> │ ';
                    output += '<span class="status-pending">PEND: ' + pad(pendingCount, 4) + '</span> │' + pad('', 51) + '│\n';
                    output += '└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘\n';
                    output += '\n';
                    output += '<span class="label">root@argus:~# </span><span class="cursor">█</span>\n';

                    document.getElementById('content').innerHTML = '<pre>' + output + '</pre>';
                    document.title = data.name + ' - Text Terminal';
                })
                .catch(error => {
                    console.error('Error:', error);
                    const output = '\n\n' +
                        '╔═══════════════════════════════════════════════════════════════╗\n' +
                        '║                         <span class="error">ERROR</span>                             ║\n' +
                        '║                                                               ║\n' +
                        '║              <span class="error">Failed to load monitor data</span>                 ║\n' +
                        '║                                                               ║\n' +
                        '╚═══════════════════════════════════════════════════════════════╝\n' +
                        '\n<span class="label">root@argus:~# </span><span class="cursor">█</span>\n';
                    document.getElementById('content').innerHTML = '<pre>' + output + '</pre>';
                });
        }

        updateMonitorData();
        setInterval(updateMonitorData, 30000);
    </script>
</body>
</html>
