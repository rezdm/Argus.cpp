<!DOCTYPE html>
<html>
<head>
    <title>Argus Status</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #fff;
            font-size: 11px;
            line-height: 1.2;
            padding: 8px;
        }
        .header {
            text-align: center;
            padding: 6px 0;
            margin-bottom: 12px;
            border-bottom: 1px solid #333;
        }
        .header h3 {
            font-size: 16px;
            font-weight: 500;
            color: #fff;
        }
        .group {
            margin-bottom: 16px;
            border: 1px solid #333;
            border-radius: 4px;
            background: #222;
        }
        .group-header {
            background: linear-gradient(90deg, #2d3748, #4a5568);
            color: #fff;
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 600;
            border-bottom: 1px solid #333;
        }
        .monitors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1px;
            padding: 0;
        }
        .monitor-item {
            display: flex;
            align-items: center;
            padding: 4px 8px;
            background: #2a2a2a;
            border-bottom: 1px solid #333;
            min-height: 28px;
        }
        .monitor-item:hover {
            background: #333;
        }
        .service-name {
            flex: 1;
            font-weight: 500;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 8px;
            font-size: 10px;
        }
        .status-indicator {
            flex-shrink: 0;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 4px;
        }
        .status-text {
            flex-shrink: 0;
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: 32px;
        }
        .status-ok .status-indicator { background: #10b981; box-shadow: 0 0 4px #10b981; }
        .status-ok .status-text { color: #10b981; }
        .status-warning .status-indicator { background: #f59e0b; box-shadow: 0 0 4px #f59e0b; }
        .status-warning .status-text { color: #f59e0b; }
        .status-error .status-indicator { background: #ef4444; box-shadow: 0 0 4px #ef4444; }
        .status-error .status-text { color: #ef4444; }

        .last-updated {
            text-align: center;
            margin-top: 12px;
            color: #666;
            font-size: 9px;
            padding: 4px 0;
            border-top: 1px solid #333;
        }
        .loading, .error {
            text-align: center;
            padding: 20px;
            font-size: 12px;
        }
        .loading { color: #666; }
        .error { color: #ef4444; }

        /* Responsive breakpoints for maximum density */
        @media (min-width: 1920px) {
            .monitors-grid { grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); }
            .service-name { font-size: 9px; }
            .monitor-item { min-height: 24px; padding: 3px 6px; }
        }
        @media (min-width: 2560px) {
            .monitors-grid { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
            .service-name { font-size: 8px; }
            .monitor-item { min-height: 22px; padding: 2px 5px; }
            .status-text { font-size: 8px; min-width: 28px; }
        }
        @media (max-width: 768px) {
            .monitors-grid { grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); }
            body { font-size: 10px; }
        }
        @media (max-width: 480px) {
            .monitors-grid { grid-template-columns: 1fr 1fr; }
            .service-name { font-size: 9px; }
        }

        /* Animation for status changes */
        .monitor-item {
            transition: background-color 0.2s ease, transform 0.1s ease;
        }
        .status-indicator {
            transition: all 0.3s ease;
        }

        /* Print optimizations for status boards */
        @media print {
            body { background: #fff; color: #000; }
            .group { border: 1px solid #000; background: #fff; }
            .monitor-item { background: #fff; }
            .status-ok .status-text { color: #000; }
            .status-warning .status-text { color: #000; }
            .status-error .status-text { color: #000; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h3 id="page-title">Argus Status</h3>
    </div>

    <div id="content">
        <div class="loading">Loading status data...</div>
    </div>

    <div class="last-updated" id="last-updated">Loading...</div>

    <script>
        function getStatusClass(status) {
            switch (status.toLowerCase()) {
                case 'ok': return 'status-ok';
                case 'warning': return 'status-warning';
                case 'failure': return 'status-error';
                default: return 'status-ok';
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function updateMonitorData() {
            fetch('/argus/status')
                .then(response => response.ok ? response.json() : Promise.reject('Network error'))
                .then(data => {
                    document.getElementById('page-title').textContent = data.name;
                    document.title = data.name + ' - Status';

                    let html = '';
                    data.groups.forEach(group => {
                        html += '<div class="group">';
                        html += '<div class="group-header">' + escapeHtml(group.name) + '</div>';
                        html += '<div class="monitors-grid">';

                        group.monitors.forEach(monitor => {
                            const statusClass = getStatusClass(monitor.status);
                            const serviceName = monitor.service.length > 20 ?
                                monitor.service.substring(0, 17) + '...' : monitor.service;
                            const statusText = monitor.status === 'OK' ? 'OK' :
                                              monitor.status === 'WARNING' ? 'WARN' : 'FAIL';

                            html += '<div class="monitor-item ' + statusClass + '" title="' +
                                    escapeHtml(monitor.service + ' - ' + monitor.host + ' - ' + monitor.status) + '">';
                            html += '<div class="status-indicator"></div>';
                            html += '<div class="service-name">' + escapeHtml(serviceName) + '</div>';
                            html += '<div class="status-text">' + statusText + '</div>';
                            html += '</div>';
                        });

                        html += '</div></div>';
                    });

                    document.getElementById('content').innerHTML = html;
                    document.getElementById('last-updated').textContent =
                        'Updated: ' + data.timestamp.split(' ')[1];
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('content').innerHTML =
                        '<div class="error">Error loading status data</div>';
                });
        }

        // Auto-refresh every 15 seconds for real-time status monitoring
        updateMonitorData();
        setInterval(updateMonitorData, 15000);

        // Keyboard shortcuts for common actions
        document.addEventListener('keydown', function(e) {
            if (e.key === 'r' || e.key === 'R') {
                updateMonitorData();
            }
        });
    </script>
</body>
</html>